<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Commander un plat</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background-color: #f5f5f5; 
      line-height: 1.6;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input, select, button {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-sizing: border-box;
    }
    button {
      background-color: #28a745;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #218838;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .loading {
      color: #666;
      font-style: italic;
    }
    .error {
      color: #dc3545;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">üçΩÔ∏è Menu du jour</h2>
  <form id="commandeForm">
    <input type="text" id="nom" placeholder="Votre nom" required>

    <label for="plat">Choisissez votre plat :</label>
    <select id="plat" required>
      <option value="" class="loading">Chargement du menu...</option>
    </select>

    <button type="submit" id="submitBtn">Commander</button>
  </form>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Configuration Firebase (√† remplacer par vos propres donn√©es)
    const firebaseConfig = {
      apiKey: "AIzaSyDpSF4J0bsd6T0ImMpse0KQQRADaxiYUQw",
      authDomain: "darhassna-484c3.firebaseapp.com",
      databaseURL: "https://darhassna-484c3-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "darhassna-484c3",
      storageBucket: "darhassna-484c3.appspot.com",
      messagingSenderId: "141393162149",
      appId: "1:141393162149:web:0717227eac221f5ddfc24c"
    };

    // Initialisation Firebase
    let database;
    try {
      firebase.initializeApp(firebaseConfig);
      database = firebase.database();
    } catch (error) {
      console.error("Erreur d'initialisation Firebase:", error);
      document.getElementById('plat').innerHTML = `
        <option value="" class="error">Erreur de connexion au serveur</option>
      `;
    }

    // Charger le menu
    async function loadMenu() {
      const select = document.getElementById("plat");
      
      try {
        // Simulation de chargement (remplacez par votre vrai appel API)
        const response = await fetch('https://exemple.com/api/menu');
        
        if (!response.ok) {
          throw new Error('√âchec du chargement du menu');
        }
        
        const menuItems = await response.json();
        
        // G√©n√©rer les options du menu
        let options = '<option value="">S√©lectionnez un plat</option>';
        menuItems.forEach(item => {
          options += `<option value="${item.id}">${item.nom} (${item.prix} DH)</option>`;
        });
        
        select.innerHTML = options;
      } catch (error) {
        console.error("Erreur:", error);
        select.innerHTML = `
          <option value="" class="error">Erreur de chargement du menu</option>
        `;
      }
    }

    // Envoyer la commande
    async function envoyerCommande(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Envoi en cours...";
      
      const nom = document.getElementById("nom").value.trim();
      const plat = document.getElementById("plat").value;

      // Validation
      if (!nom || !plat) {
        alert("Veuillez remplir tous les champs !");
        submitBtn.disabled = false;
        submitBtn.textContent = "Commander";
        return;
      }

      try {
        // Envoyer √† Firebase
        await database.ref("commandes").push({
          nom: nom,
          plat: plat,
          timestamp: Date.now(),
          etat: "En attente"
        });

        // Succ√®s
        alert("‚úÖ Commande envoy√©e avec succ√®s !");
        document.getElementById("nom").value = "";
        document.getElementById("plat").value = "";
      } catch (error) {
        console.error("Erreur:", error);
        alert("‚ùå √âchec de l'envoi de la commande. Veuillez r√©essayer.");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Commander";
      }
    }

    // √âv√©nements
    document.getElementById("commandeForm").addEventListener("submit", envoyerCommande);
    window.addEventListener('load', loadMenu);
  </script>
</body>
</html>
